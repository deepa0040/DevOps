## Monitor Cluster Components
Monitoring cluster components is a core part of Kubernetes operations, especially for performance, reliability, and debugging. 

### What to Monitor
Effectively monitoring a Kubernetes cluster involves tracking metrics at both the node and pod levels.

For nodes, consider monitoring the following:

- Total number of nodes in the cluster
- Health status of each node
- Performance metrics such as CPU, memory, network, and disk utilization

For pods, focus on:

- The number of running pods
- CPU and memory consumption for every pod

Because Kubernetes does not include a comprehensive built-in monitoring solution, you must implement an external tool. Popular open-source monitoring solutions include Metrics Server, Prometheus, and Elastic Stack. In addition, proprietary options like Datadog and Dynatrace are available for more advanced use cases.

### Metric server
- The Metrics Server is a cluster-wide component that collects and aggregates real-time resource usage data (CPU and memory) from all nodes and pods.
- Collects CPU and memory (RAM) metrics from each node and pod.

- Used by kubectl top, Horizontal Pod Autoscaler (HPA), and Vertical Pod Autoscaler (VPA).

- It does not store historical data — provides only current, real-time metrics.

### How It Works
- Metrics Server collects metrics from the Kubelet’s /metrics/resource API on each node.

- It aggregates the data and makes it available via the Kubernetes API.

- Runs as a deployment in the kube-system namespace.

### Install Metrics Server (manually)
```
kubectl apply -f https://github.com/kubernetes-sigs/metrics-server/releases/latest/download/components.yaml
``` 
```
kubectl get deployment metrics-server -n kube-system
```
### kubectl Commands
| Command                            | Description                         |
| ---------------------------------- | ----------------------------------- |
| `kubectl top node`                 | Show CPU/memory usage for each node |
| `kubectl top pod`                  | Show CPU/memory usage for each pod  |
| `kubectl top pod --all-namespaces` | Across all namespaces               |


## Managing Application Logs

- Logs help debug issues, monitor app behavior, and audit events.

- Kubernetes does not store logs — it simply allows access to logs generated by containers.

- Logs are ephemeral — deleted if the pod is deleted or container crashes (unless handled by a logging solution).

### Types of Logs in Kubernetes
| Type                          | Description                                     |
| ----------------------------- | ----------------------------------------------- |
| **Container logs**            | stdout/stderr logs from containers              |
| **Node logs**                 | OS-level or system logs (journalctl, /var/log/) |
| **Kubernetes component logs** | e.g., kubelet, kube-apiserver, etc.             |
| **Application logs**          | Generated by the running application            |

### Accessing Logs (CLI)
| Command                             | Description                                   |
| ----------------------------------- | --------------------------------------------- |
| `kubectl logs <pod>`                | Show logs of main container                   |
| `kubectl logs <pod> -c <container>` | Show logs of a specific container             |
| `kubectl logs --previous`           | View logs from the previous crashed container |
| `kubectl logs -f <pod>`             | Stream logs in real-time (follow)             |

### Where Logs Are Stored (by default)
- Logs are written to:
`/var/log/containers/` → symlinked to `/var/log/pods/` and Docker container logs under `/var/lib/docker/containers/`

- On container runtimes like containerd, logs are in:
`/var/log/pods/<namespace>_<pod-name>_<UID>/`

Logs are stored locally on the node and are lost if the pod is deleted or the node crashes — unless forwarded externally.

### How Logs Are Collected
- Sidecar container or daemonSet runs on all nodes

- Reads logs from /var/log/containers/ or via container runtime API

- Forwards logs to external storage (Elasticsearch, Loki, etc.)

---

Reference: https://kubernetes.io/docs/tasks/debug/debug-cluster/resource-metrics-pipeline/
